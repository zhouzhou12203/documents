import math

# 定义被积函数，处理x=0的情况
def f(x):
    if x == 0:
        return 1.0
    else:
        return math.sin(x) / x

# 计算梯形法则积分，n为区间数，use_given_data标记是否使用题目提供的n=8数据
def trapezoidal(n, a=0, b=1, use_given_data=False):
    h = (b - a) / n
    total = 0.0
    if use_given_data and n == 8:
        # 直接使用题目提供的n=8时的数据
        x_values = [0.0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1.0]
        f_values = [1.0, 0.99739784, 0.98961584, 0.97672675, 0.95885108,
                     0.93615563, 0.90885168, 0.87719257, 0.84147098]
        total = f_values[0] + f_values[-1]
        for i in range(1, n):
            total += 2 * f_values[i]
    else:
        # 正常计算节点值
        total = f(a) + f(b)
        for i in range(1, n):
            x = a + i * h
            total += 2 * f(x)
    return (h / 2) * total

# 初始化T0列表，n=1,2,4,8,16
T0 = [
    trapezoidal(n=1),                # k=0, h=1
    trapezoidal(n=2),                # k=1, h=0.5
    trapezoidal(n=4),                # k=2, h=0.25
    trapezoidal(n=8, use_given_data=True),  # k=3, h=0.125，使用给定数据
    trapezoidal(n=16)                # k=4, h=0.0625
]

# 第一次外推（辛普森法则）
T1 = [
    (4 * T0[1] - T0[0]) / 3,        # T1^(0)
    (4 * T0[2] - T0[1]) / 3,        # T1^(1)
    (4 * T0[3] - T0[2]) / 3,        # T1^(2)
    (4 * T0[4] - T0[3]) / 3         # T1^(3)
]

# 第二次外推（龙贝格公式）
T2 = [
    (16 * T1[1] - T1[0]) / 15,      # T2^(0)
    (16 * T1[2] - T1[1]) / 15,      # T2^(1)
    (16 * T1[3] - T1[2]) / 15       # T2^(2)
]

# 第三次外推
T3 = [
    (64 * T2[1] - T2[0]) / 63,      # T3^(0)
    (64 * T2[2] - T2[1]) / 63       # T3^(1)
]

# 第四次外推
T4 = [
    (256 * T3[1] - T3[0]) / 255     # T4^(0)
]

# 打印递推表
print("龙贝格递推表：")
print("k | h      | T0         | T1         | T2         | T3         | T4")
print("-------------------------------------------------------------------------------")
print(f"0 | 1      | {T0[0]:.6f}  | {'':<10} | {'':<10} | {'':<10} | {'':<10}")
print(f"1 | 0.5    | {T0[1]:.6f}  | {T1[0]:.6f}  | {'':<10} | {'':<10} | {'':<10}")
print(f"2 | 0.25   | {T0[2]:.6f}  | {T1[1]:.6f}  | {T2[0]:.6f}  | {'':<10} | {'':<10}")
print(f"3 | 0.125  | {T0[3]:.6f}  | {T1[2]:.6f}  | {T2[1]:.6f}  | {T3[0]:.6f}  | {'':<10}")
print(f"4 | 0.0625 | {T0[4]:.6f}  | {T1[3]:.6f}  | {T2[2]:.6f}  | {T3[1]:.6f}  | {T4[0]:.6f}")

# 最终结果
print("\n龙贝格积分结果：")
print(f"\033[1m{T4[0]:.6f}\033[0m")
